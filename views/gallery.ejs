<!DOCTYPE html>
<html>
  <head>
    <title>Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f8f9fa;
      }

      .top-bar {
        background: #ffffff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .gallery-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .gallery-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .gallery-img {
        height: 15rem;
        object-fit: cover;
        cursor: pointer;
      }

      .btn-sm {
        min-width: 90px;
      }

      .rename-input {
        max-width: 160px;
      }

      /* Modal image */
      .modal-img {
        max-height: 85vh;
        object-fit: contain;
      }
    </style>
  </head>

  <body>
    <!-- Top Bar -->
    <div class="top-bar p-3 d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Gallery</h5>

      <form action="/logout" method="POST">
        <button class="btn btn-danger btn-sm">Logout</button>
      </form>
    </div>

    <!-- Content -->
    <div class="container mt-4">
      <div class="text-center mb-4">
        <a href="/" class="btn btn-primary">Upload More</a>
      </div>

      <div class="row">
        <% if (images.length > 0) { %> <% images.forEach((image) => { %>
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
          <div class="card gallery-card h-100">
            <img
              src="<%= image.url %>"
              class="card-img-top gallery-img"
              alt="<%= image.originalName %>"
              data-bs-toggle="modal"
              data-bs-target="#imageModal"
              data-src="<%= image.url %>"
              data-name="<%= image.originalName %>"
            />

            <div class="card-body text-center">
              <p class="fw-semibold mb-2"><%= image.originalName %></p>

              <!-- Rename -->
              <form
                method="POST"
                action="/rename"
                class="d-flex justify-content-center gap-2 mb-2"
              >
                <input type="hidden" name="id" value="<%= image._id %>" />
                <input
                  type="text"
                  name="newName"
                  class="form-control form-control-sm rename-input"
                  placeholder="New name"
                  required
                />
                <button class="btn btn-warning btn-sm">Rename</button>
              </form>

              <!-- Actions -->
              <div class="d-flex justify-content-center gap-2">
                <a
                  href="/download/<%= image._id %>"
                  class="btn btn-success btn-sm"
                >
                  Download
                </a>

                <form
                  method="POST"
                  action="/delete"
                  onsubmit="return confirm('Delete image?')"
                >
                  <input
                    type="hidden"
                    name="public_id"
                    value="<%= image.publicId %>"
                  />
                  <button class="btn btn-danger btn-sm">Delete</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <% }) %> <% } else { %>
        <p class="text-center text-muted">No images found.</p>
        <% } %>
      </div>
    </div>

    <!-- FULL SCREEN IMAGE MODAL -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle"></h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body text-center">
            <img id="modalImage" class="img-fluid modal-img" />
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const imageModal = document.getElementById("imageModal");
      const modalImage = document.getElementById("modalImage");
      const modalTitle = document.getElementById("modalTitle");

      imageModal.addEventListener("show.bs.modal", function (event) {
        const img = event.relatedTarget;
        modalImage.src = img.getAttribute("data-src");
        modalTitle.textContent = img.getAttribute("data-name");
      });
    </script>
  </body>
</html>
